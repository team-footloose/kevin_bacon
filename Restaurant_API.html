<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Restaurant</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
          integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="js/jquery.js"></script>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    <!-- import jQuery -->
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <!-- import Assembly JavaScript -->
    <script async defer src='https://api.mapbox.com/mapbox-assembly/v0.21.2/assembly.js'></script>
    <!-- import Assembly CSS -->
    <link href='https://api.mapbox.com/mapbox-assembly/v0.21.2/assembly.min.css' rel='stylesheet'>
    <script src="js/keys.js"></script>
    <script src="js/mapbox-utils.js"></script>
</head>
<body>


<h1>Restaurant</h1>
<h3>Open</h3>
<div id="openRestaurant">
</div>
<h3>Pizza</h3>
<div id="pizzaRestaurant"></div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="js/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>

<script>

    $('document').ready
    {
        "use strict";
        const daysWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const now = new Date();
        // let currentTime = now.getTime();
        let currentDay = daysWeek[now.getDay()];
        let hour = now.getHours();
        let minutes = now.getMinutes();

        function restaurantOpen(timeOpen, currentHours, currentMinutes) {
            //get values
            let valueStart = timeOpen.substring(0, timeOpen.indexOf("-")).trim();
            let valueStop = timeOpen.substring(timeOpen.indexOf("-") + 1).trim();

            let startHours = parseInt(valueStart);

            if (valueStart.indexOf('pm') > 0) {
                startHours += 12;
            }

            let endHours = parseInt(valueStop);

            if (valueStop.indexOf('pm') > 0) {
                endHours += 12;
            }

            if (startHours > currentHours) return false;
            // Check for the minutes

            let openMinutes = 0;
            if (valueStart.indexOf(':') > 0) {
                openMinutes = valueStart.substring(valueStart.indexOf(":") + 1).trim();
            }

            if (startHours === currentHours) {
                if (openMinutes > currentMinutes) {
                    return false
                }
            }

            // The close hour if before the current time

            if (endHours < currentHours) return false;
            // Check for the minutes

            if (valueStop.indexOf(':') > 0) {
                openMinutes = valueStop.substring(valueStop.indexOf(":") + 1).trim();
            }

            if (endHours === currentHours) {
                if (openMinutes < currentMinutes) return false;
            }

            return true;

        }

        // $.get('https://frest.glitch.me/restaurants', {
        //     limit: 10,
        //     offset: 20
        // }).done(function (restaurants) {
        //      console.log(restaurants);
        //     let openRestaurants = [];
        //     let pizzaRestaurants = [];
        //     // let restaurants = data;
        //     for (let restaurant of restaurants) {
        //         // Is open
        //
        //         // Pizza
        //         if (restaurant["cuisine_type"] === "Pizza") pizzaRestaurants.push(restaurant);
        //     }
        //     // Set variable to current date and time
        //
        //     // console.log(now.getDay());
        //     console.log(pizzaRestaurants);
        //
        //     // Is Open
        //
        //     // Pizza
        //     /**
        //      *
        //      * address: "171 E Broadway, New York, NY 10002"
        //      createdAt: 1504095563444
        //      cuisine_type: "Asian"
        //      id: 1
        //      is_favorite: "true"
        //      latlng: {lat: 40.713829, lng: -73.989667}
        //      name: "Mission Chinese Food"
        //      neighborhood: "Manhattan"
        //      operating_hours:
        //      Friday: "5:30 pm - 11:00 pm"
        //      Monday: "5:30 pm - 11:00 pm"
        //      Saturday: "12:00 pm - 4:00 pm, 5:30 pm - 12:00 am"
        //      Sunday: "12:00 pm - 4:00 pm, 5:30 pm - 11:00 pm"
        //      Thursday: "5:30 pm - 11:00 pm"
        //      Tuesday: "5:30 pm - 11:00 pm"
        //      Wednesday: "5:30 pm - 11:00 pm"
        //      * **/
        // });


        $.ajax({
            url: 'https://frest.glitch.me/restaurants',
            type: "GET",
            // data: { 'DistributorId': distributorId },
            dataType: "json",
            traditional: true,
            // contentType: "application/json; charset=utf-8",
            success: function (restaurants) {
                // alert('success');
                // console.log(restaurants);
                let openRestaurants = [];
                let pizzaRestaurants = [];
                // let closeTime =[];
                // let restaurants = data;
                let openHTML = "<ul></ul>";
                let pizzaHTML = "<ul></ul>";

                for (let restaurant of restaurants) {

                    // Is open
                    let operatingHours = restaurant["operating_hours"];
                    // console.log(operatingHours);
                    let timeOpen = operatingHours[currentDay].split(',');
                    // console.log(currentTime);
                    // console.log(timeOpen);

                    timeOpen.forEach(function (openHours) {
                        openRestaurants.push(openHours);
                        openRestaurants.push(hour);
                        openRestaurants.push(minutes);
                        if (restaurantOpen(openHours, hour, minutes)) {
                            openRestaurants.push(restaurant);
                            openHTML += `<li>${restaurant["name"]} ${openHours}</li>`
                        }

                        // console.log((restaurantOpen(isOpen, hour, minutes)));
                    });

                    // Pizza
                    if (restaurant["cuisine_type"] === "Pizza") {pizzaRestaurants.push(restaurant);
                        pizzaHTML += `<li>${restaurant["name"]} ${restaurant["cuisine_type"]}</li>`
                    }
                }
                // Set variable to current date and time

                console.log(now.getDay());
                console.log(openRestaurants);
                console.log(pizzaRestaurants);
                $('#openRestaurant').append(openHTML);
                $('#pizzaRestaurant').append(pizzaHTML);


            },
            error: function () {
                alert("An error has occured!!!");
            }
        });


    }
    /**
     * ### Restaurant API
     ​
     Using the endpoint ```https://frest.glitch.me/restaurants```, complete the following exercises:
     ​
     1. return an array of restaurant objects that are currently open
     1. return the number of "Pizza" restaurants
     1. **EXTRA CHALLENGE:** find the restaurant closest to "Katz's Delicatessen"
     1. **EXTRA CHALLENGE:** use Bootstrap or CSS Grid with Flexbox to style out cards for all restarants and use JS to dynamically build the cards
     */
</script>


</body>
</html>